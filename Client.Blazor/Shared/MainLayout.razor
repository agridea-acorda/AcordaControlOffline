@using Agridea.ProductInfo
@using Blazored.LocalStorage
@using Config = Agridea.Acorda.AcordaControlOffline.Client.Blazor.UiServices.Config

@inherits LayoutComponentBase
@inject IJSRuntime Js
@inject NavigationManager Navigation
@inject ILocalStorageService LocalStorage

<div class="wrapper">
    <nav class="main-header navbar navbar-expand navbar-dark navbar-success">
        <ul class="navbar-nav">
            <li class="nav-item">
                <a class="nav-link" data-widget="pushmenu" href="#"><i class="fas fa-bars"></i></a>
            </li>
        </ul>
        <ul class="navbar-nav ml-auto">
            <li class="nav-item">
                <a class="nav-link btn btn-outline-warning" href="#" @onclick="Reset">Réinitialiser</a>
            </li>
            <UserDisplay />
            <CantonDisplay />
        </ul>
    </nav>

    <aside class="main-sidebar sidebar-dark-primary elevation-4">
        <a href="#" class="brand-link navbar-success" @onclick='() => Navigation.NavigateTo(Config.BaseUrl + "/")'>
            <img src="logo.png" alt="AcordaControl logo" class="brand-image img-rounded elevation-2" style="margin-top: -1px; margin-left: 9px;" />
            <span class="brand-text font-weight-normal"><b>Acorda</b>Control</span>
        </a>
    </aside>

    <div class="content-wrapper">
        <section class="content-header">
            <div class="container-fluid">
                <div class="row mb-2">
                    <div class="col-sm-6">
                        <h1>Mandats de contrôle</h1>
                    </div>
                </div>
            </div>
        </section>
        <section class="content">
            <div class="container-fluid">
                @Body
            </div>
        </section>
    </div>

    <footer class="main-footer">
        <AppFooter FileVersion="@ProductInfo.Version" BuildDate="@ProductInfo.BuildDate" />
    </footer>
</div>

@code {

    protected override void OnInitialized()
    {
        Console.WriteLine("Executing OnInitialized from MainLayout");
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await Js.InvokeVoidAsync(JsInterop.InitAdminLte);
        }
    }

    async void Reset()
    {
        await LocalStorage.ClearAsync();
        Navigation.NavigateTo(Config.BaseUrl + "/", true);
    }

}